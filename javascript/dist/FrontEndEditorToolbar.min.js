!function(t){function e(t){var e,n=top.tinymce.activeEditor,o=n.selection,s=o.getContent();if(/</.test(s)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(s)||-1===s.indexOf("href=")))return!1;if(t){if(e=t.childNodes,0===e.length)return!1;for(i=e.length-1;i>=0;i--)if(3!==e[i].nodeType)return!1}return!0}ss.editorWrappers.tinyMCE4=function(){return{init:function(){ss.editorWrappers.tinyMCE4.initialized=!0},getInstance:function(){return this.instance},setInstance:function(t){this.instance=t},onopen:function(){},onclose:function(){},save:function(){tinyMCE.triggerSave()},create:function(e,n){t("#"+e).tinymce(n),this.instance=top.tinymce.activeEditor},repaint:function(){},isDirty:function(){return this.getInstance().isDirty()},getContent:function(){return this.getInstance().getContent()},getDOM:function(){return this.getInstance().dom},getContainer:function(){return this.getInstance().getContainer()},getSelectedNode:function(){return this.getInstance().selection.getNode()},selectNode:function(t){this.getInstance().selection.select(t)},setContent:function(t,e){this.getInstance().execCommand("mceSetContent",!1,t,e)},insertContent:function(t,e){this.getInstance().execCommand("mceInsertContent",!1,t,e)},replaceContent:function(t,e){this.getInstance().execCommand("mceReplaceContent",!1,t,e)},insertLink:function(t){var n=this.getInstance(),i=n.selection,o=n.dom,s=i.getNode(),c=o.getParent(s,"a[href]"),r=c?c.innerText||c.textContent:i.getContent({format:"text"}),a=e();c?(n.focus(),a&&("innerText"in c?c.innerText=r:c.textContent=r),o.setAttribs(c,t),i.select(c),n.undoManager.add()):a?n.insertContent(o.createHTML("a",t,o.encode(r))):n.execCommand("mceInsertLink",!1,t)},removeLink:function(){this.getInstance().execCommand("unlink",!1)},cleanLink:function(t,e){return this.getInstance().settings.urlconverter_callback?this.getInstance().execCallback("urlconverter_callback",t,e,!0):(t.match(new RegExp("^"+this.getInstance().settings.document_base_url+"(.*)$"))&&(t=RegExp.$1),t)},createBookmark:function(){return this.getInstance().selection.getBookmark()},moveToBookmark:function(t){this.getInstance().selection.moveToBookmark(t),this.getInstance().focus()},blur:function(){this.getInstance().selection.collapse()},addUndo:function(){this.getInstance().undoManager.add()},closeDialog:function(){this.getInstance().windowManager.close()}}},ss.editorWrappers["default"]=ss.editorWrappers.tinyMCE4;var n=new ss.editorWrappers["default"];n.setInstance(top.tinymce.activeEditor),t.entwine("ss",function(t){t("form.htmleditorfield-form").entwine({close:function(){this.getDialog().close()},getEditor:function(){return n}}),t("form.htmleditorfield-form button").entwine({onadd:function(){this.button().addClass("ss-ui-button")}}),t("form.htmleditorfield-linkform button[name=action_remove]").entwine({onclick:function(t){t.preventDefault(),this.parents("form:first").removeLink()}}),t(".htmleditorfield-dialog").entwine({onadd:function(){this.trigger("ssdialogopen"),this._super()},getEditor:function(){return n},close:function(){this.getEditor().closeDialog()}})})}(jQuery);