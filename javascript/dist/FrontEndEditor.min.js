var frontEndAdmin=frontEndAdmin||{};!function(e){function t(t){var n="",i=e(t.getElement()),s={fefield:i.data("fefield"),feid:i.data("feid"),feclass:i.data("feclass"),value:t.getContent()};i.data("originalContent",t.getContent()),i.hasClass("frontend-editable-html")&&(n=e(s.value),n.find(".ss-htmleditorfield-file.embed").each(function(){var t=e(this),n="[embed width='"+t.attr("width")+"' height='"+t.attr("height")+"' class='"+t.data("cssclass")+"' thumbnail='"+t.data("thumbnail")+"']"+t.data("url")+"[/embed]";t.replaceWith(n)}),n.length&&(s.value=e("<div />").append(n).html())),t.getBody().setAttribute("contenteditable","false"),a(s,i,function(){t.getBody().setAttribute("contenteditable","true")})}function n(e){var t={fefield:e.data("fefield"),feid:e.data("feid"),feclass:e.data("feclass"),value:e.val()};e.prop("disabled",!0),a(t,e,function(){e.prop("disabled",!1)})}function a(t,n,a){var i,s,o=e.Event("FrontEndEditor:onBeforeSave");e(document).trigger(o,[t,n]),o.isDefaultPrevented()||(i=SS_StatusMessage.loading("Saving "+t.fefield,"Saving",{sticky:!0}),s=e.Callbacks(),e.isFunction(a)&&s.add(a),s.add(function(e){SS_StatusMessage.create(e.content,SS_StatusMessageTypes.fromForm(e.type),e.title,e.options)}),e.post(frontEndAdmin.baseHref+"home/fesave",t).done(function(t){var a=e.Event("FrontEndEditor:onAfterSave");e(document).trigger(a,[t,n]),a.isDefaultPrevented()||s.fire(t,n)}).fail(function(e){SS_StatusMessage.danger("Unexpected error occurred<br/>"+e.responseText,"error")}).always(function(){i.hide()}))}if(frontEndAdmin.baseHref=e("base").attr("href"),-1!==e("title").text().search("<")){var i=e(e("title").text());e("title").html(i.text())}frontEndAdmin.tinymceGlobalDefaults={inline:!0,save_enablewhendirty:!1,save_onsavecallback:t,script_url:frontEndAdmin.baseHref+"silverstripe-frontend-admin/bower_components/tinymce/tinymce.min.js",external_plugins:{SSFEButtons:frontEndAdmin.baseHref+"silverstripe-frontend-admin/javascript/dist/tinymce_ssfebuttons.min.js"}},frontEndAdmin.tinymceDefaults=e.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save advlist autolink lists image charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code fullscreen","insertdatetime media nonbreaking save table contextmenu directionality","emoticons template paste textcolor  nonbreaking SSFEButtons"],toolbar1:"save cancel | undo redo | cut copy paste | ssfeLink ssfeimage charmap table | searchreplace",toolbar2:"styleselect bold italic removeformat | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | code",contextmenu:"ssfeLink ssfeimage inserttable | cell row column deletetable",image_advtab:!0,remove_script_host:!0,convert_urls:!0,relative_urls:!0,menubar:!1,document_base_url:frontEndAdmin.baseHref,extended_valid_elements:"-p[style|class]"}),frontEndAdmin.tinymceVarCharDefaults=e.extend({},frontEndAdmin.tinymceGlobalDefaults,{plugins:["save "],toolbar1:"save cancel undo redo ",menubar:!1,statusbar:!1,toolbar_items_size:"small"}),frontEndAdmin.tinymceTextDefaults=frontEndAdmin.tinymceVarCharDefaults,e("a .frontend-editable").click(function(e){e.preventDefault()}),e(".frontend-editable-varchar, .frontend-editable-text, .frontend-editable-html").entwine({onmatch:function(){var t,n,a=e.Event("FrontEndEditor:onBeforeInitEditor"),i=e("<span class='fe-label' style='position: absolute'><span class='fe-label-text'></span></span>"),s=this.offset();i.css({top:s.top-i.outerHeight(),left:s.left}).find(".fe-label-text").html("<b>"+this.data("fefield")+"</b><small> - "+this.data("feclass")+" ("+this.data("feid")+")</small>"),this.data("fe-label",i),i.data("fe-field",this),e("body").append(i),this.hasClass("frontend-editable-varchar")?(t=e.extend({},frontEndAdmin.tinymceVarCharDefaults),n=e.Event("FrontEndEditor:onAfterInitVarChar")):this.hasClass("frontend-editable-text")?(t=e.extend({},frontEndAdmin.tinymceTextDefaults),n=e.Event("FrontEndEditor:onAfterInitVarChar")):this.hasClass("frontend-editable-html")&&(t=e.extend({},frontEndAdmin.tinymceDefaults),n=e.Event("FrontEndEditor:onAfterInitHTML")),e(document).trigger(a,[this,t]),!a.isDefaultPrevented()&&t&&(this.tinymce(t),e(document).trigger(n,[this]))},onmouseenter:function(){this.showLabel()},onmouseleave:function(){this.hideLabel()},onfocusin:function(){this.showLabel()},onfocusout:function(){this.hideLabel()},showLabel:function(){var e=this.data("fe-label");e&&(this.positionLabel(),e.addClass("fe-label-show"))},hideLabel:function(){var e=this.data("fe-label");e&&!this.is(":focus")&&e.removeClass("fe-label-show")},positionLabel:function(){var e=this.data("fe-label"),t=this.offset(),n=parseInt(e.css("padding-left"),10),a=t.top,i=t.left;e&&(a-=e.outerHeight(),n&&(i-=n),e.css({top:a,left:i}))}}),e(".frontend-editable-enum, .frontend-editable-boolean").entwine({SaveEnabled:!0,onmatch:function(){var t=e.Event("FrontEndEditor:onBeforeInitEditor");e(document).trigger(t,[this,options]),this.setSaveEnabled(!t.isDefaultPrevented())},onchange:function(){this.getSaveEnabled()&&n(this)}})}(jQuery);